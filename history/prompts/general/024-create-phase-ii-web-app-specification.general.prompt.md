---
id: 24
title: create-phase-ii-web-app-specification
stage: spec
date: 2026-01-16
surface: agent
model: "openai/gpt-4o"
feature: web-app-auth
branch: 1-web-app-auth
user: metachemist
command: "/sp.specify"
labels: ["specification", "web-application", "authentication", "phase-II"]
links:
  spec: null
  ticket: null
  adr: null
  pr: null
files:
 - /home/metachemist/projects/myprograms/gen_ai/evolution-of-todo-list-01/specs/1-specify/features/feature-02-web-application.md
 - /home/metachemist/projects/myprograms/gen_ai/evolution-of-todo-list-01/specs/1-specify/features/feature-02-web-api.md
 - /home/metachemist/projects/myprograms/gen_ai/evolution-of-todo-list-01/specs/1-specify/features/feature-03-authentication.md
 - /home/metachemist/projects/myprograms/gen_ai/evolution-of-todo-list-01/specs/1-specify/system-overview.md
 - /home/metachemist/projects/myprograms/gen_ai/evolution-of-todo-list-01/specs/1-specify/checklists/requirements.md
tests:
 - null
---

## Prompt

# ROLE Act as a Senior Product Owner and Systems Architect. # CONTEXT We have completed Phase I (Console). We are starting **Phase II: Full-Stack Web Application**. # INPUTS 1. Read `constitution.md` (Focus on Phase II Tech Stack: Next.js, FastAPI, SQLModel, Neon DB, Better Auth). 2. Read `specs/1-specify/features/feature-01-task-crud.md` (Retain existing business logic). # TASK: GENERATE PHASE II SPECS # Feature Specification: Full-Stack Web Application (Phase II) **Version**: 1.0 **Phase**: II - Full-Stack Web Application **Status**: Draft **Last Updated**: 2026-01-16 ## 1. Overview ### 1.1 Purpose Transform the Phase I console application into a modern multi-user web application with persistent storage, RESTful API, and user authentication. ### 1.2 Scope This specification covers Phase II requirements: - All Phase I features as web UI (Add, Delete, Update, View, Mark Complete) - User authentication (signup/signin) with Better Auth + JWT - RESTful API with FastAPI backend - Responsive Next.js frontend - Persistent storage with Neon Serverless PostgreSQL - User data isolation ### 1.3 Out of Scope (Future Phases) - AI chatbot interface (Phase III) - Natural language processing (Phase III) - Kubernetes deployment (Phase IV) - Advanced features: priorities, tags, search, filters (Phase V) - Event streaming with Kafka (Phase V) ### 1.4 Dependencies - Phase I console application completed - All Phase I specifications and tasks implemented ## 2. User Stories ### 2.1 Authentication Stories #### US-AUTH-001: User Signup **As a** new user **I want to** create an account with email and password **So that** I can securely access my todo list **Acceptance Criteria:** - User can register with email, name, and password - Email must be unique (no duplicates) - Password must be minimum 8 characters - System validates email format - System creates user account in database - User receives success confirmation - Passwords are hashed before storage (never stored in plain text) #### US-AUTH-002: User Signin **As a** registered user **I want to** sign in with my credentials **So that** I can access my todo list **Acceptance Criteria:** - User can sign in with email and password - System validates credentials - System issues JWT token on successful authentication - Token expires after 7 days - Invalid credentials show clear error message - User is redirected to dashboard after signin #### US-AUTH-003: Session Management **As a** signed-in user **I want to** stay signed in until I log out **So that** I don't have to re-authenticate frequently **Acceptance Criteria:** - JWT token stored securely in browser - Token included in all API requests - Expired tokens redirect to signin page - User can explicitly sign out - Sign out clears token and redirects to signin page ### 2.2 Task Management Stories (Web Version) #### US-WEB-001: Add Task via Web UI **As a** signed-in user **I want to** create tasks through a web form **So that** I can easily add todos from any device **Acceptance Criteria:** - User sees "Add Task" button/form on dashboard - Form has fields for title (required) and description (optional) - Title validation: 1-200 characters - Description validation: max 1000 characters - Form shows validation errors inline - Successful creation shows task in list immediately - Task is associated with authenticated user only #### US-WEB-002: View Tasks via Web UI **As a** signed-in user **I want to** see all my tasks in a web interface **So that** I can review them from any browser **Acceptance Criteria:** - Dashboard displays all user's tasks - Each task shows: title, description, status, created date - Completed tasks visually distinct from incomplete - Empty state shows helpful message ("No tasks yet") - Tasks load automatically on page load - Only the authenticated user's tasks are visible #### US-WEB-003: Update Task via Web UI **As a** signed-in user **I want to** edit task details through a web form **So that** I can correct or clarify task information **Acceptance Criteria:** - User can click "Edit" button on any task - Edit form pre-fills with current task data - User can modify title and/or description - Validation same as create (title 1-200, description max 1000) - Changes save on submit - Updated task reflects immediately in UI - User can cancel edit without saving #### US-WEB-004: Delete Task via Web UI **As a** signed-in user **I want to** remove tasks through the web interface **So that** I can keep my list relevant **Acceptance Criteria:** - User can click "Delete" button on any task - System shows confirmation dialog - Confirmation required before deletion - Task removed from UI immediately after confirmation - Only task owner can delete their tasks #### US-WEB-005: Mark Complete via Web UI **As a** signed-in user **I want to** toggle task completion with a click **So that** I can easily track my progress **Acceptance Criteria:** - User can click checkbox or button to toggle status - Visual feedback shows completion state change - No confirmation needed (toggle action) - Completed tasks can be unmarked - Change persists to database ## 3. Functional Requirements ### 3.1 Data Models #### FR-DATA-001: User Model ```python User: - id: string (UUID, primary key) - email: string (unique, not null) - name: string (not null) - password_hash: string (not null, hashed) - created_at: datetime (auto-generated) - updated_at: datetime (auto-updated) ``` #### FR-DATA-002: Task Model (Enhanced) ```python Task: - id: integer (auto-increment, primary key) - user_id: string (foreign key -> User.id, not null) - title: string (not null, 1-200 chars) - description: string (nullable, max 1000 chars) - completed: boolean (default false) - created_at: datetime (auto-generated) - updated_at: datetime (auto-updated) ``` ### 3.2 Authentication Requirements #### FR-AUTH-001: Better Auth Integration - Use Better Auth library for authentication - Configure JWT plugin for token generation - Shared secret between frontend and backend - Token expiry: 7 days - Refresh token support (optional but recommended) #### FR-AUTH-002: Password Security - Hash passwords using bcrypt (minimum cost factor 12) - Never store plain text passwords - Password requirements: minimum 8 characters - Validate password strength on signup #### FR-AUTH-003: JWT Token Structure ```json { "user_id": "uuid-string", "email": "user@example.com", "exp": 1234567890, "iat": 1234567890 } ``` #### FR-AUTH-004: Protected Routes - All task API endpoints require valid JWT - Frontend redirects to signin if no token - Backend returns 401 Unauthorized for invalid/missing tokens ### 3.3 API Requirements #### FR-API-001: RESTful Endpoints All endpoints follow REST conventions with proper HTTP methods and status codes. **Authentication Endpoints:** - `POST /api/auth/signup` - Create user account - `POST /api/auth/signin` - Authenticate user - `POST /api/auth/signout` - Invalidate session **Task Endpoints (all require JWT):** - `GET /api/{user_id}/tasks` - List all user tasks - `POST /api/{user_id}/tasks` - Create new task - `GET /api/{user_id}/tasks/{id}` - Get specific task - `PUT /api/{user_id}/tasks/{id}` - Update task - `DELETE /api/{user_id}/tasks/{id}` - Delete task - `PATCH /api/{user_id}/tasks/{id}/complete` - Toggle completion #### FR-API-002: Request/Response Format All API endpoints accept and return JSON with proper Content-Type headers. **Standard Success Response:** ```json { "success": true, "data": { ... } } ``` **Standard Error Response:** ```json { "success": false, "error": { "code": "ERROR_CODE", "message": "Human readable message" } } ``` #### FR-API-003: User Isolation - All task operations filtered by authenticated user_id - Users cannot access other users' tasks - API validates user_id in URL matches JWT token user_id - Database queries always include user_id filter ### 3.4 Frontend Requirements #### FR-FE-001: Next.js App Router - Use Next.js 16+ App Router (not Pages Router) - Server-side rendering by default - Client components only for interactivity #### FR-FE-002: Page Structure ``` app/ â”œâ”€â”€ layout.tsx # Root layout â”œâ”€â”€ page.tsx # Landing/marketing page â”œâ”€â”€ signin/ â”‚ â””â”€â”€ page.tsx # Sign in page â”œâ”€â”€ signup/ â”‚ â””â”€â”€ page.tsx # Sign up page â””â”€â”€ dashboard/ â””â”€â”€ page.tsx # Main todo dashboard (protected) ``` #### FR-FE-003: Component Structure ``` components/ â”œâ”€â”€ auth/ â”‚ â”œâ”€â”€ SigninForm.tsx â”‚ â””â”€â”€ SignupForm.tsx â”œâ”€â”€ tasks/ â”‚ â”œâ”€â”€ TaskList.tsx â”‚ â”œâ”€â”€ TaskItem.tsx â”‚ â”œâ”€â”€ TaskForm.tsx # For add/edit â”‚ â””â”€â”€ DeleteConfirm.tsx â””â”€â”€ ui/ â”œâ”€â”€ Button.tsx â”œâ”€â”€ Input.tsx â””â”€â”€ Card.tsx ``` #### FR-FE-004: State Management - Use React Server Components where possible - Client-side state for forms and interactivity - API calls through centralized `/lib/api.ts` client - Token management through Better Auth hooks ### 3.5 Database Requirements #### FR-DB-001: Neon Serverless PostgreSQL - Use Neon as managed PostgreSQL provider - Connection pooling enabled - SSL/TLS encryption required #### FR-DB-002: Schema Migrations - Use SQLModel/Alembic for migrations - Version control all migration files - Separate dev and production databases #### FR-DB-003: Indexes ```sql -- Users table CREATE INDEX idx_users_email ON users(email); -- Tasks table CREATE INDEX idx_tasks_user_id ON tasks(user_id); CREATE INDEX idx_tasks_completed ON tasks(completed); CREATE INDEX idx_tasks_created_at ON tasks(created_at); ``` #### FR-DB-004: Constraints ```sql -- Foreign key constraint ALTER TABLE tasks ADD CONSTRAINT fk_tasks_user FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE; -- Unique constraint ALTER TABLE users ADD CONSTRAINT unique_email UNIQUE (email); ``` ## 4. Non-Functional Requirements ### 4.1 Performance #### NFR-PERF-001: API Response Times - CREATE: < 200ms (95th percentile) - READ: < 100ms (95th percentile) - UPDATE: < 150ms (95th percentile) - DELETE: < 100ms (95th percentile) #### NFR-PERF-002: Frontend Performance - First Contentful Paint (FCP): < 1.5s - Largest Contentful Paint (LCP): < 2.5s - Time to Interactive (TTI): < 3.0s - Cumulative Layout Shift (CLS): < 0.1 #### NFR-PERF-003: Database Performance - Query execution: < 50ms average - Connection pool: 10-20 connections - Database connection timeout: 30s ### 4.2 Security #### NFR-SEC-001: HTTPS Only - All production traffic over HTTPS - Redirect HTTP to HTTPS automatically - HSTS headers enabled #### NFR-SEC-002: Input Validation - All user inputs validated on both client and server - SQL injection prevention via ORM parameterized queries - XSS prevention via React automatic escaping - CSRF protection for state-changing operations #### NFR-SEC-003: Secrets Management - Environment variables for all secrets - Never commit secrets to version control - Different secrets for dev/staging/production - Rotate secrets regularly #### NFR-SEC-004: Rate Limiting (Optional but Recommended) - Authentication endpoints: 5 requests per minute per IP - Task API endpoints: 100 requests per minute per user ### 4.3 Scalability #### NFR-SCALE-001: Stateless Backend - No session storage on server - All state in JWT tokens or database - Horizontal scaling ready #### NFR-SCALE-002: Database Connection Pooling - Efficient connection reuse - Max connections: 20 - Idle timeout: 60 seconds #### NFR-SCALE-003: Caching (Optional for Phase II) - HTTP caching headers for static assets - Database query caching for frequently accessed data ### 4.4 Usability #### NFR-UX-001: Responsive Design - Mobile-first approach - Breakpoints: 640px (mobile), 768px (tablet), 1024px (desktop) - Touch-friendly UI elements (min 44x44px) #### NFR-UX-002: Error Handling - User-friendly error messages - Form validation with inline errors - Network error handling with retry - Loading states for all async operations #### NFR-UX-003: Accessibility - WCAG 2.1 Level AA compliance - Keyboard navigation support - Screen reader compatibility - Sufficient color contrast (4.5:1 minimum) ### 4.5 Code Quality #### NFR-QUALITY-001: Testing - Backend unit tests: > 80% coverage - Frontend component tests: > 70% coverage - Integration tests for critical flows - E2E tests for auth and CRUD operations #### NFR-QUALITY-002: Linting & Formatting - Backend: Ruff for Python - Frontend: ESLint + Prettier for TypeScript - Pre-commit hooks for formatting - CI/CD pipeline enforces checks #### NFR-QUALITY-003: Type Safety - Python: Type hints for all functions - TypeScript: Strict mode enabled - No `any` types in frontend code - API types shared between frontend/backend ## 5. User Interface Specification ### 5.1 Landing Page (`/`) ``` â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ [Logo] Todo Evolution [Sign In]â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚ â”‚ Manage Your Tasks Better â”‚ â”‚ â”‚ â”‚ [Get Started] [Learn More] â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ ``` ### 5.2 Sign Up Page (`/signup`) ``` â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ Create Account â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ Name: [_____________________] â”‚ â”‚ Email: [_____________________] â”‚ â”‚ Password: [_____________________] â”‚ â”‚ â”‚ â”‚ [âœ“] I agree to Terms of Service â”‚ â”‚ â”‚ â”‚ [Create Account] â”‚ â”‚ â”‚ â”‚ Already have account? [Sign In] â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ ``` ### 5.3 Sign In Page (`/signin`) ``` â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ Welcome Back â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ Email: [_____________________] â”‚ â”‚ Password: [_____________________] â”‚ â”‚ â”‚ â”‚ [âœ“] Remember me â”‚ â”‚ â”‚ â”‚ [Sign In] â”‚ â”‚ â”‚ â”‚ Don't have account? [Sign Up] â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ ``` ### 5.4 Dashboard (`/dashboard`) ``` â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ [Logo] My Tasks User Menu [â–¼] [Logout]â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚ â”‚ [+ Add Task] Filter: [All â–¼]â”‚ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ [âœ“] Buy groceries [Edit][Ã—]â”‚ â”‚ â”‚ Milk, eggs, bread â”‚ â”‚ â”‚ Created: Jan 14, 2026 â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ [ ] Finish homework [Edit][Ã—]â”‚ â”‚ â”‚ Math assignment chapter 5 â”‚ â”‚ â”‚ Created: Jan 15, 2026 â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚ Showing 2 tasks â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ ``` ### 5.5 Add/Edit Task Modal ``` â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ Add New Task [Ã—] â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ Title: * â”‚ â”‚ [_________________________________] â”‚ â”‚ â”‚ â”‚ Description: â”‚ â”‚ [_________________________________] â”‚ â”‚ [_________________________________] â”‚ â”‚ [_________________________________] â”‚ â”‚ â”‚ â”‚ [Cancel] [Save Task] â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ ``` ### 5.6 Delete Confirmation ``` â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ Confirm Deletion [Ã—] â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ Are you sure you want to delete â”‚ â”‚ "Buy groceries"? â”‚ â”‚ â”‚ â”‚ This action cannot be undone. â”‚ â”‚ â”‚ â”‚ [Cancel] [Delete] â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ ``` ## 6. API Specification ### 6.1 Authentication Endpoints #### POST /api/auth/signup **Request:** ```json { "name": "John Doe", "email": "john@example.com", "password": "securePass123" } ``` **Success Response (201):** ```json { "success": true, "data": { "user": { "id": "uuid-123", "email": "john@example.com", "name": "John Doe", "created_at": "2026-01-16T10:00:00Z" }, "token": "jwt-token-here" } } ``` **Error Response (400):** ```json { "success": false, "error": { "code": "EMAIL_EXISTS", "message": "Email already registered" } } ``` #### POST /api/auth/signin **Request:** ```json { "email": "john@example.com", "password": "securePass123" } ``` **Success Response (200):** ```json { "success": true, "data": { "user": { "id": "uuid-123", "email": "john@example.com", "name": "John Doe" }, "token": "jwt-token-here" } } ``` **Error Response (401):** ```json { "success": false, "error": { "code": "INVALID_CREDENTIALS", "message": "Invalid email or password" } } ``` ### 6.2 Task Endpoints #### GET /api/{user_id}/tasks **Headers:** ``` Authorization: Bearer {jwt-token} ``` **Query Parameters:** - `status` (optional): "all" | "pending" | "completed" **Success Response (200):** ```json { "success": true, "data": { "tasks": [ { "id": 1, "user_id": "uuid-123", "title": "Buy groceries", "description": "Milk, eggs, bread", "completed": false, "created_at": "2026-01-14T10:30:00Z", "updated_at": "2026-01-14T10:30:00Z" } ], "count": 1 } } ``` #### POST /api/{user_id}/tasks **Headers:** ``` Authorization: Bearer {jwt-token} Content-Type: application/json ``` **Request:** ```json { "title": "Buy groceries", "description": "Milk, eggs, bread" } ``` **Success Response (201):** ```json { "success": true, "data": { "task": { "id": 1, "user_id": "uuid-123", "title": "Buy groceries", "description": "Milk, eggs, bread", "completed": false, "created_at": "2026-01-14T10:30:00Z", "updated_at": "2026-01-14T10:30:00Z" } } } ``` #### PUT /api/{user_id}/tasks/{id} **Headers:** ``` Authorization: Bearer {jwt-token} Content-Type: application/json ``` **Request:** ```json { "title": "Buy groceries and fruits", "description": "Milk, eggs, bread, apples" } ``` **Success Response (200):** ```json { "success": true, "data": { "task": { "id": 1, "user_id": "uuid-123", "title": "Buy groceries and fruits", "description": "Milk, eggs, bread, apples", "completed": false, "created_at": "2026-01-14T10:30:00Z", "updated_at": "2026-01-16T11:00:00Z" } } } ``` #### DELETE /api/{user_id}/tasks/{id} **Headers:** ``` Authorization: Bearer {jwt-token} ``` **Success Response (200):** ```json { "success": true, "data": { "message": "Task deleted successfully" } } ``` #### PATCH /api/{user_id}/tasks/{id}/complete **Headers:** ``` Authorization: Bearer {jwt-token} ``` **Success Response (200):** ```json { "success": true, "data": { "task": { "id": 1, "completed": true, "updated_at": "2026-01-16T12:00:00Z" } } } ``` ### 6.3 Error Codes | Code | HTTP Status | Description | |------|-------------|-------------| | EMAIL_EXISTS | 400 | Email already registered | | INVALID_CREDENTIALS | 401 | Invalid email/password | | UNAUTHORIZED | 401 | Missing or invalid JWT token | | FORBIDDEN | 403 | User cannot access resource | | NOT_FOUND | 404 | Resource not found | | VALIDATION_ERROR | 422 | Invalid input data | | SERVER_ERROR | 500 | Internal server error | ## 7. Business Rules ### BR-001: User Isolation - Users can only view/modify their own tasks - Task operations must validate user_id matches JWT token - Database queries always filter by user_id ### BR-002: Email Uniqueness - Each email can only be registered once - Email comparison is case-insensitive - Duplicate signup attempts return clear error ### BR-003: Task Ownership - Tasks are created with user_id from JWT token - User cannot specify different user_id in request - Deleting user cascades to delete all their tasks ### BR-004: Token Expiration - JWT tokens expire after 7 days - Expired tokens require re-authentication - Refresh token can extend session (optional) ### BR-005: Input Sanitization - All text inputs trimmed of whitespace - HTML tags stripped/escaped - SQL injection prevented via ORM ## 8. Edge Cases ### EC-001: Concurrent Updates - Last write wins (no conflict resolution needed for Phase II) - UI shows latest data after update - Optimistic UI updates with rollback on error ### EC-002: Network Failures - API calls have 30-second timeout - Failed requests show retry option - Offline state detected and displayed ### EC-003: Invalid Tokens - Expired tokens redirect to signin - Malformed tokens return 401 - Missing tokens redirect to signin (frontend) ### EC-004: Database Unavailable - Connection errors caught and logged - User sees friendly error message - Automatic retry with exponential backoff ### EC-005: Email Already Exists - Signup with existing email shows clear error - Suggest password reset instead - Don't reveal if email exists (security) ## 9. Testing Requirements ### 9.1 Backend Unit Tests **Authentication Service:** - User registration with valid data - User registration with duplicate email - User signin with valid credentials - User signin with invalid credentials - JWT token generation and validation - Password hashing and verification **Task Service:** - Create task for authenticated user - Get all tasks filtered by user_id - Update task (owner only) - Delete task (owner only) - Toggle completion status - Validate user isolation (cannot access other users' tasks) **API Endpoints:** - All endpoints with valid JWT - All endpoints with invalid/missing JWT - All endpoints with proper error handling - Input validation for all request bodies ### 9.2 Frontend Component Tests **Authentication Components:** - SignupForm renders correctly - SignupForm validation (email, password) - SigninForm renders correctly - SigninForm submission **Task Components:** - TaskList renders empty state - TaskList renders tasks - TaskItem displays task data correctly - TaskForm validation (title required, length limits) - DeleteConfirm shows confirmation dialog ### 9.3 Integration Tests **Authentication Flow:** - Complete signup â†’ signin â†’ access dashboard - Invalid credentials handled correctly - Token expiration redirects to signin **Task CRUD Flow:** - Create task â†’ appears in list - Update task â†’ changes persist - Delete task â†’ removed from list - Toggle complete â†’ status updates ### 9.4 E2E Tests (Optional but Recommended) **User Journey:** 1. Sign up new user 2. Sign in 3. Add 3 tasks 4. Mark 1 task complete 5. Edit 1 task 6. Delete 1 task 7. Sign out 8. Sign in again â†’ verify tasks persisted ### 9.5 Security Tests - SQL injection attempts blocked - XSS attempts sanitized - CSRF protection working - Unauthorized access prevented ## 10. Success Criteria Phase II is complete when: - âœ“ All Phase I features working in web UI - âœ“ User signup/signin functional with Better Auth - âœ“ JWT authentication protecting all task endpoints - âœ“ Frontend deployed to Vercel - âœ“ Backend deployed and accessible - âœ“ Neon database configured and migrated - âœ“ All acceptance criteria met - âœ“ Test coverage > 80% for backend, > 70% for frontend - âœ“ All quality checks pass (linting, formatting) - âœ“ User isolation verified (cannot access other users' data) - âœ“ Demo video recorded (< 90 seconds) - âœ“ All code generated via Qwen CLI with proper task references - âœ“ README updated with Phase II setup instructions ## 11. Dependencies ### 11.1 External Services - Neon Serverless PostgreSQL (database) - Vercel (frontend hosting) - Backend hosting (DigitalOcean/Railway/Render TBD) ### 11.2 Frontend Dependencies - Next.js 16+ - React 19+ - Better Auth - TypeScript - Tailwind CSS - React Hook Form (forms) - Zod (validation) ### 11.3 Backend Dependencies - Python 3.13+ - FastAPI - SQLModel - Uvicorn - Python-Jose (JWT) - Passlib (password hashing) - Psycopg2-binary (PostgreSQL driver) ### 11.4 Development Tools - UV (package manager) - Pytest (backend testing) - Vitest/Jest (frontend testing) - Ruff (Python linting) - ESLint + Prettier (TypeScript linting) ## 12. Deployment ### 12.1 Frontend Deployment (Vercel) - Automatic deployments from main branch - Environment variables configured - Custom domain (optional) ### 12.2 Backend Deployment - Choose hosting: Railway, Render, or DigitalOcean App Platform - Environment variables configured - Health check endpoint: `GET /health` - Auto-scaling enabled (if supported) ### 12.3 Database - Neon Serverless PostgreSQL - Connection pooling enabled - Backups configured (Neon automatic) ### 12.4 Environment Variables **Frontend (.env.local):** ``` NEXT_PUBLIC_API_URL=http://localhost:8000 NEXT_PUBLIC_BETTER_AUTH_URL=http://localhost:3000 BETTER_AUTH_SECRET=your-secret-key ``` **Backend (.env):** ``` DATABASE_URL=postgresql://user:pass@host/db BETTER_AUTH_SECRET=your-secret-key JWT_SECRET_KEY=your-jwt-secret JWT_ALGORITHM=HS256 JWT_EXPIRATION_DAYS=7 ``` ## 13. Migration from Phase I ### 13.1 Data Migration Phase I used in-memory storage. No data migration needed (fresh start with database). ### 13.2 Code Reuse - Task model structure similar to Phase I - Validation logic can be adapted - Business rules remain consistent ### 13.3 Breaking Changes - Multi-user vs single-user - Persistent vs in-memory storage - Web UI vs console interface - Authentication added ## 14. Future Considerations (Not in Phase II) - Multi-factor authentication (2FA) - Email verification - Password reset flow - Social authentication (Google, GitHub) - Real-time updates (WebSockets) - Offline support (PWA) - Mobile apps (React Native) - Advanced task features (priorities, tags, etc. - Phase V) ## 15. Assumptions - Users have modern browsers (Chrome, Firefox, Safari, Edge) - JavaScript enabled in browser - Internet connection required (no offline mode) - Email is unique identifier for users - One user per browser session - Tasks are personal (no sharing/collaboration) ## 16. Glossary - **Better Auth**: Authentication library for Next.js applications - **JWT**: JSON Web Token - compact, URL-safe token format - **SQLModel**: Python library combining SQLAlchemy and Pydantic - **Neon**: Serverless PostgreSQL database service - **App Router**: Next.js 13+ routing system (vs Pages Router) - **SSR**: Server-Side Rendering - **User Isolation**: Each user can only access their own data --- # OUTPUT FILES ## File 1: `specs/1-specify/features/feature-02-web-api.md` - **Goal**: Expose Task CRUD via REST API. - **Endpoints**: Define the contract for: - `GET /api/tasks` (List) - `POST /api/tasks` (Create) - `PATCH /api/tasks/{id}` (Update/Complete) - `DELETE /api/tasks/{id}` (Delete) - **Security**: All endpoints must require a valid JWT token. ## File 2: `specs/1-specify/features/feature-03-authentication.md` - **Goal**: Multi-user support. - **User Stories**: Sign up, Sign in, Sign out. - **Constraints**: Use "Better Auth" (Next.js) -> JWT -> FastAPI verification. - **Data Isolation**: "As a user, I only see *my* tasks." ## File 3: `specs/1-specify/system-overview.md` (UPDATE) - Update the vision to "Web-Scale". - Add Phase II success metrics (API response < 200ms). - Define the new Domain Entity: `User` (id, email, name). - **Scope**: Explicitly state that we are REPLACING `InMemoryRepository` with `PostgresRepository`. # QUALITY GATES - Explicitly define the Auth flow: Frontend generates token -> Backend verifies token. - Do NOT explain *how* to implement Better Auth code yet, just the functional requirement.

## Response snapshot

I have successfully created the complete Phase II specification for the Todo Evolution project, including:

1. Main feature specification (feature-02-web-application.md) covering the full-stack web application requirements
2. API specification (feature-02-web-api.md) defining the REST API contract
3. Authentication specification (feature-03-authentication.md) detailing the user authentication system
4. Updated system overview (system-overview.md) reflecting the transition to web-scale
5. Quality checklist (requirements.md) validating the specifications

The specifications comprehensively cover:
- User stories for authentication (signup, signin, session management)
- User stories for task management via web UI
- Data models for User and enhanced Task entities
- API endpoints with proper authentication requirements
- Frontend requirements using Next.js App Router
- Database requirements with Neon PostgreSQL
- Non-functional requirements for performance, security, scalability
- User interface specifications
- Business rules and edge cases
- Testing requirements
- Success criteria for Phase II

All specifications follow the required template structure and focus on user value and business needs without implementation details.

## Outcome

- âœ… Impact: Successfully created comprehensive Phase II specifications for web application
- ğŸ§ª Tests: N/A (specification work, not implementation)
- ğŸ“ Files: Created 4 specification files and 1 checklist file
- ğŸ” Next prompts: Ready to proceed with /sp.plan to create implementation plan
- ğŸ§  Reflection: Specifications provide clear roadmap for Phase II implementation with proper user isolation and authentication.

## Evaluation notes (flywheel)

- Failure modes observed: None - all specifications created successfully
- Graders run and results (PASS/FAIL): N/A (specification work)
- Prompt variant (if applicable): N/A
- Next experiment (smallest change to try): Proceed with planning phase (/sp.plan)